function post_to_wx(){var e={msgType:"heartbeat",shareTitle:document.title,shareURL:document.URL,scrollTop:document.documentElement.scrollTop,time:(new Date).valueOf()};wx.miniProgram.postMessage({data:e}),wx.miniProgram.getEnv((function(e){window.is_miniprogram=e.miniprogram}))}function handleOutURL(e,t,n,o){console.log("劫持链接 "+e),wx.miniProgram.navigateTo({url:"/pages/index/redirect?outURL="+encodeURIComponent(e)+"&inwhitelist="+t+"&handleFile="+n+"&ext="+o})}function override_onclick(e){if(window.is_miniprogram){let t=e.currentTarget.getAttribute("href"),n=new URL(t),o=new Set;o.add("mirrors.sustech.edu.cn"),o.add("bus.sustcra.com"),o.add("sustech.online"),o.add("");let a=new Set;a.add("doc"),a.add("docx"),a.add("xls"),a.add("xlsx"),a.add("ppt"),a.add("pptx"),a.add("pdf");let i=n.hostname,r=n.pathname.split(".").pop().toLowerCase(),s=o.has(i),d=a.has(r);if(s&&!d)return console.log("放行白名单页面 "+t),void(window.location.href=t);e.preventDefault(),console.log("小程序环境，拦截外部链接或者可显示文件。"),handleOutURL(t,s,d,r)}}function reset_all_anchor(){for(var e=document.getElementsByTagName("a"),t=0;t<e.length;t++){var n=e[t];n.hasAttribute("data-fancybox")?console.log("skip fancybox a tag: ",n.getAttribute("href")):n.onclick=function(){override_onclick(event)}}}function isInWechatMP(){return navigator.userAgent.match(/miniprogram/i)||"miniprogram"===window.__wxjs_environment}function load_adsense(){if(console.log("判断环境，加载 adsense"),!1===isInWechatMP()){console.log("非小程序环境，加载");var e=document.createElement("script");e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",e.setAttribute("async",""),e.setAttribute("data-ad-client","ca-pub-9039393129169217"),document.head.appendChild(e)}else console.log("小程序环境，跳过")}setInterval(post_to_wx,1e3),setInterval(reset_all_anchor,1e3),setTimeout("load_adsense()",500);